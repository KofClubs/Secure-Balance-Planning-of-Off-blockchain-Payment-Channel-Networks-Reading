前言和动机

在本节中，我们将介绍一些必要关于支付渠道和支付网络的准备工作，下面是一些对
本文有启发作用的观察结果。

A、 支付通道
支付通道可以通过智能合约实现。当两个节点同意建立一个支付通道时，它们会创建
一个智能合约，锁定一些加密货币作为通道余额。一旦通道建立起来，它们可以通过
通道进行交易并自行维护通道余额，而无需提交这些交易到区块链。支付通道可以是
单向的或者双向的。单向通道的一个例子如图1（a）所示。Alice为Bob创造了一个
单向通道，用α表示，它们在通道上的余额是分别用αA和αB表示。Alice从她的区块
链账户中向该通道存入了3枚比特币（Alice共有10枚）作为她的初始余额，即αA=3，
随后将这一结果提交给区块链。此后，在αA足够的情况下，Alice可以不通过区块链
也能向Bob进行支付。因为α是一个单向通道，所以它不允许Bob通过该通道向Alice
进行支付。

双向通道则允许双向支付。如图1（b）所示，Alice和Bob都可以在通道中存入一些
比特币，当他们打开通道时这些比特币就被区块链记录下来。然后，他们就可以互相
支付并相应地维护通道余额。通过观察双向通道我们发现可以让一个节点支付比其初
始存款更多的费用。在在图1（b）中，Alice总共付给Bob3.5个比特币，但是她的初
始存款只有3枚比特币。这是因为Bob给Alice的支付可以记入Alice的余额。因此双向
通道具有更强的支付能力。

Alice和Bob都可以关闭通道，通常是因为他们的余额不足以进行更多的交易或是在通
道余额上有分歧。他们的最终通道余额会同步到区块链。

**图1。

B、 支付网络

由于维护大量智能合约的开销很大，一个节点不可能与其他每个节点都建立一个支付
通道。为了使两个没有直接通道的节点可以进行交易，提出了由多个支付通道组成的
支付网络的概念。具有单向通道的支付网络如图2所示。如果节点A想支付给节点C，
它可以要求B节点转发此支付，形成一个支付路径（A、B、C）。其中关键点是保
证节点B转发正确数量的比特币，而不从中窃取比特币。哈希时间锁协议（HTLC）
就是为了解决这一问题而提出的。HTLC的基本思想是让A和B都锁定同样数量的比特
币在通道上。HTLC使用加密技术来保证节点B只有在成功支付给C时才能得到锁
定在通道（A,B）上的比特币。

实际上，支付路径上的中间节点不会免费转发支付，而是要收取一定的转发费，这些
费用可以是固定的也可以按转发金额成比例收取。由于存在转发费，每个节点需要准
备比实际支付数额多的比特币。在图2所示的示例中，节点A打算支付5个比特币给C，
因为节点B收取1个比特币作为转发费，因此节点A需要向B支付6个比特币。通常两个
节点间存在多条路径，优先选择转发费用较少的路径。

**图2。