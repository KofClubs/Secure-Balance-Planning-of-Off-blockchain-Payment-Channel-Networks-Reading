C、 单向通道的余额规划
要实现网络规划的经济性目标，需要设计一种算法来最小化存入支付通道的硬币数量。作者用bij表示单向通道（i，j）的初始余额（i，j）∈E，fpuv（i，j）表示沿路径p（p∈Puv）上通道（i，j）从节点u到节点v的支付。余额规划问题可以表述为：**公式1、**公式2、**公式3、**公式4。

每个节点i∈N都有一个有限的通道建设预算Bi，它受（1）的约束。由于路径p上每个中间节点i都要收取转发费用，其前一跳通道（i，j）的支付费用应高于下一跳通道（j，k）的，这一点由约束（2）表示。约束（3）表明所有通道（i，j）的总支付费用不能超过该单向通道初始余额bij。最后，所有可能路径上的总支付应不小于需求量duv，这可以通过**公式5表示。然而，实际中很难准确估计每对节点之间的支付需求duv。为了克服这一困难，作者将支付需求duv建模为一个随机变量，并将其表示为约束（4），它允许一个小的中断概率ε。

解决uniBP_chance问题的主要困难是解决机会约束（4），作者应用Bernstein逼近[18]将约束（4）转化为线性约束，同时保证相应解的可行性。假设duv的分布在[dmin，dmax]内有界，这可以通过分析历史交易记录得到。通过定义**公式和**公式，duv可以在[−1，1]内标准化，如下所示：**公式6。机会约束（4）可以等价地写成**公式7。

根据Bernstein逼近[18]，上述约束可近似写成:**公式8，**公式可以表示为**公式9。

定理1：对于给定的ε，假设存在一个使（8）成立的解。那么，这个解也满足（4）。

证明可通过以下方式完成[18]。由于篇幅限制，作者省略了细节。此外，[18]给出的另一个有用结论是Ω（w）的上界由**公式10给出。
其中−1≤μ−≤μ+≤1和σ≥0是由给定概率分布决定的常数。

使用（10），约束（8）可以近似的写为**公式11。

上面约束中的inf(·)可以用**公式去掉，这样约束(11)就可以等价的写为**公式12。

最终，作者得到了如下线性规划公式：**公式。由于BP-linear包含实变量和线性约束，因此可以通过一些成熟的算法来高效地求解，例如单纯形算法或内点算法[19]。

**fig.3
D、双向通道的余额规划
双向支付通道允许双向支付，具有更强的支付能力。由于一个节点可以支付比其初始存款更多数额，因此约束（4）不能应用于双向通道。作者使用图3中的一个例子来促进双向通道的形成。作者首先假设Alice和Bob对彼此有2个硬币的支付需求，即dAB=2和dBA=2。没有必要让他们存入2个硬币作为初始余额。如图3（a）所示，初始余额αa=1和αB=1就可以满足他们的支付需求。如果Alice向Bob的支付需求增长到4个硬币，那么Alice需要存入2个硬币，如图3（b）所示。通过仔细研究上述例子中的支付过程，作者发现Alice的初始余额αa不能小于收入减去支出的金额。Bob则没有这样的约束，因为它付给Alice的报酬较少。上述事实可以用**公式13表示。

根据约束（13），Bob的初始余额可以是0，如图3（b）所示。但是，这样的话会限制Bob的支付，直到收到Alice支付的硬币。在作者的模型中，不要求延迟付款，在该阶段结束之前完成所有的付款是可以的。但是，作者仍然让每个节点存入一些硬币bmin作为通道的初始余额，以减少实际支付延迟。bmin的值可以根据历史支付情况和延期付款的要求进行估算，但在理论上不能提供强有力的延期保证。具有双向渠道的支付网络的余额规划问题可以描述为：**公式。

采用和第IV-C节中类似的方法可以把上述问题转化为线性版本的biBP_linear问题。

