A.实验设置
作者的将PnP实现为可插拔服务，即允许启用和不启用。PnP服务通过RPC接口跟闪电网络守护程序（lnd）[13]进行交互，这个网络是闪电网络全体节点的完整实现。PnP包含两个主要模块，即分类和计划求解器。在分类模块中，作者使用Curve 25529来实现签名和VRF（可验证随机函数），哈希算法是SHA256。

作者在包含30个节点的测试平台评估PnP的性能。节点之间的潜在支付通道是根据Watts-Strogatz小世界模型[20]随机生成的。我们知道，现实世界网络具有小世界特性，即存在聚集特性。作者设置，每个节点的预算是[1000，1500]区间内的随机数，可以拥有至多6个邻接节点，转发费用跟转发金额成正比，费率在[0.01，0.1]区间内随机分配。作者同时要求决策委员会的分类权重约为全体节点总权重的三分之一。支付中断概率设置成0.05，所有实验运行50个epoch。PnP是进行余额规划的第一步工作，作者将其跟使用不同设计的几种PnP变体进行比较，如下所示。

PNP_greedy：对于每种需求，我们首先从候选路径集选择具有最低转发费的最短路径，然后沿该路径建立支付管道。假如路径的剩余余额不能满足支付需求，则选择下一条最短的路径，直到选到合适的路径。

PNP_exp：决策委员会根据付款需求的期望，通过将约束条件（4）替换为约束条件（5）来解决余额规划问题。

PNP_rebalance：节点定期重新平衡其通道，我们将REVIVE[12]的重新平衡思想与PnP相结合。由于重新平衡的开销，我们将每个epoch的重新平衡操作限制在3次以内。

B. 实验结果
1）分类结果：作者首先用成为决策委员会成员的可能性来评估分类功能。如图4所示，黑色长条表示节点在50个epoch内的平均分类权重，其他长条表示成为决策委员会成员的时间。
**图4 不同节点的分类权重和成为决策委员会成员的时间

结果表明，被选择的机会与分类权重的比例大致相符。贡献更多锁定在支付通道的余额的节点有更多的机会被选成决策委员会成员。由于恶意节点的预算有限，它们被选入决策委员会的可能性很低，无法操纵余额计划结果。在图5中，我们显示决策委员会权重和决策委员会在每个epoch持有的总权重。我们发现，尽管实验结果跟理论值存在偏差且实验值波动更大，但两者的平均误差仅为17％。我们随机地将几个节点标记为恶意节点，它们总是占决策委员会总人数的不到三分之一，如图6所示，作者在这里得到结论，PBFT协议可以很好地保证余额计划结果的正确性。
**图5 不同epoch下决策委员会的分类权重实验值和理论值
**图6 随机选择的恶意节点（黑柱）在决策委员会所占的比例

2）余额计划结果：图7给出了不同需求估计误差下的满足支付需求的数量。估计误差对PnP的影响很小，不到3％，但是PnP_exp这个变体在很大程度上取决于支付需求估计的准确性。当平均支付需求估计误差从30减少到10时，PnP_exp满足的需求数从27.8增加到36.6，可以看出PnP_exp对估计结果敏感。
**图7 不同PnP变体满足支付需求数量的变化

图8显示了PnP及其不同变体满足需求的数目，实验结果在50个epoch内取算术平均值，每个epoch有50个需求，其估计误差约为20。PnP完成了约95％的付款需求，PnP_greedy的表现最差，它满足的需求少于30个。
**图8 PnP及其变体满足的转账需求数目

作者把转账交易额最小值设置成0.2。如果通道余额小于0.2，那么这意味着这个支付通道已经耗尽。图9给出了PnP及其不同变体耗尽的支付通道数目。我们观察到PnP平均创建82个通道，仅消耗4个通道。PnP_rebalance依赖动态重新平衡机制工作，它在尽可能少地产生被耗尽的支付通道层面的表现优于PNP_greedy和PNP_exp。
**图9 PnP及其变体被耗尽的支付通道数目

接着，作者研究了付款需求对初始支付通道存款和交易完成情况的影响。如图10(a)所示，随着需求数量从20增加到60，分配到支付通道的余额预算数量也增加。值得注意的是，PnP和PNP_rebalance的余额预算数量相等，原因是PNP_rebalance同样会使用机会约束优化的结果，两者的不同主要在于PNP_rebalance会动态地再平衡支付通道。尽管PnP和PNP_rebalance消耗更多的余额预算，但实际上它们具有更强的满足支付需求的能力，这一点可以在图10(b)中找到证据，该证据显示了不同支付需求下的已完成支付总额。
**图10 支付需求对PnP及其变体的影响，包括需求数量和转账额度

作者从网络中随机删除一些节点来考察网络的健壮性。图11显示了网络规模的影响。随着网络规模的增长，网络中沉积的总预算会增加。原因是在较大的网络中，两个随机节点之间的路径变得更长，跳数更多。在这条更长的路径上，所有节点都需要存放在它周围的支付通道中锁定一定的余额进行预付款，这必然导致渠道存款的增长。另外，随着网络规模的扩大，成功支付的费用会略有下降，一般地，在更长的路径中，通道耗尽的概率更大。虽然PnP使用更多的预算，节点加入网络的成本上升，但是由于机会受限优化，它可以实现更多成功的付款。

最后，作者研究了单向和双向通道的PnP性能。 如图12所示，双工PnP需要更少的预算和更强的支付能力。双工PnP在支付需求更大的情况下，优势更大。这是合理的，双工通道处理在反向付款方面更有优势，付款请求越多，命中双向付款的频率越高。
