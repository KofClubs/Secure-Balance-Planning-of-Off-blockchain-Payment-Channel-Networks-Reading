随着比特币[1]的诞生，区块链实现了不依赖受信任第三方的数字货币流通。 后来，以太坊[2]通过引入智能合约实现了可编程节点，扩展了区块链的功能。智能合约的本质是可以被节点自动执行的程序。

区块链使用了为了实现去中心化和一致性对所有节点引入共识协议，这牺牲了区块链的可伸缩性。目前，比特币每秒只能处理7个事务，而以太坊将性能提高到每秒约15个事务。最近的一些工作[3]–[5]提出了新的共识机制来支持每秒数千个事务，但仍不能满足大规模应用程序的性能要求。Trillo[6]报告说，Visa在2013年假期期间每秒处理约47,000个事务，而任何现有的区块链都无法支持这样高的事务频率。

现有多数提高区块链处理事务效率的方法着眼于共识机制的改进和设计，本文提出了支付通道[7][8]，即在两节点见建立专用的支付通道来提高区块链处理事务的效率。借助区块链2.0的可编程节点，支付通道可以实现成一个智能合约。这个智能合约会锁定来自两端节点一定的初始余额，在一定时间内，余额由节点在链下维护，系统只需要在一定时间把交易发送上链即可。

节点之间的多个支付通道构成一个支付网络，即使两节点不相邻，即没有支付通道直接连接，它们仍然可以在一定的跳数内通过多个支付通道完成链下交易。目前，支付网络已经在区块链得到了广泛应用。例如，闪电网络[7]为比特币设计，雷电网络为以太坊设计[8]。

支付通道的关键问题是将多少资金作为初始余额存入。资金过少会导致支付通道更早地耗尽余额，重新访问区块链来重建支付通道；资金过多会导致一些潜在的问题，例如更多余额很少的节点很难加入支付网络、每个节点能够分配余额的支付通道更少导致支付网络拓扑连通性减弱等。支付网络的一个挑战性问题是多跳交易。目前多跳交易的研究[9]-[11]总是不现实地假设支付通道资金足够。 Khalil等[12]通过设计REVIVE开始关注这个问题，它使节点能够在支付通道间重新平衡资金。但是，仅仅重新平衡并不总是一个好的解决方案，因为实际上节点之间的支付额通常是不对称的，有很显著的倾向性。另外，REVIVE采用的集中式设计需要受信任的第三方来运行重新平衡算法，这样的第三方总是不安全的，如果受信任第三方受到攻击，那么整个网络都不能正常工作。

作者研究了支付网络的余额规划问题，即在估计支付需求的前提下确定支付通道锁定的的初始余额。作者设计了PnP这样一个可以被集成到现有支付网络的余额规划服务。 PnP利用付款需求的先验知识来规划整个支付网络锁定的初始余额，它的目标是尽可能多地在余额命中付款需求，尽可能少地在支付网络锁定余额。 它不依赖受信任的第三方，可以抵抗恶意节点的攻击，具有较低的通信和计算开销。

本文的研究面临2个主要的挑战。第一，节点之间的支付需求难以准确估计。一个直观的想法是根据历史交易记录预测未来的付款需求，并据此设计算法来确定初始通道余额，不过显然地，通过历史数据估计不能从根源避免预测值的偏差。一旦通道的余额用尽，跟通道关联的支付事务会立即失效。试图改变预测方法来规避预测偏差总是不完全可靠的。在本文中，作者通过将余额规划问题表示为机会受限的优化问题来描述和处理付款需求的不确定性。作者根据研究设计了一种解决该问题的算法，从理论上保证支付请求高命中率。

第二，区块链这样的开放式分布式系统总是存在不信任问题，支付网络中可能存在恶意节点，它们试图损害服务，包括余额规划服务。支付网络上的许多现有服务都假设存在受信任的第三方，这样的假设本身非常强，实际上不总是很现实的。PnP允许部分拜占庭对手采取任意行动并试图操纵规划结果，PnP随机选择了一组节点作为决策委员会来生成正确的规划结果，不依赖任何受信任的第三方。PnP通过解决两个关键问题来保证安全：应选拔谁进入决策委员会，以及决策委员会如何就正确的规划结果达成协议。作者为委员会成员选举提出了一种密码分类机制，委员会中的每个节点独立运行余额规划算法，通过拜占庭协议达成协议。

作者将PnP应用在Lightning Network[7]的完整实现Lightning Network Daemon（lnd）[13]上，并创建了虚拟支付网络作为性能评估的测试平台。作者用很多其他的支付网络设计服务跟这项有开创性的工作作对比。

作者设计了用于支付网络的余额规划服务PnP；为了保护PnP免受攻击，作者使用加密分类选举决策委员会来运行服务算法，由于节点之间没有交互，通信开销较低；作者研究了在满足节点间支付需求的同时，最大限度地减少存入支付渠道的总资金的问题，这个问题通过机会约束来描述；作者在30个节点的网络上测试PnP，测试结果表明PnP能够以较高概率满足付款需求，同时最多完成比其他设计多30％的付款事务。

本文的其余部分安排如下，第二部分介绍了有关支付网络和PnP的初步知识，第三部分介绍了系统模型，第四部分介绍了具有单向和双向通道的支付网络的即插即用设计，第五部分介绍了实验结果，第六部分给出了相关工作，第七部分总结了本文。
